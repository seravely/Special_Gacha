<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìŠ¤í˜ì…œ ë½‘ê¸°íŒ (ë‹¨ì¼ HTML)</title>
  <style>
    :root{ --bg:#fff; --card:#fff; --muted:#64748b; --border:#e2e8f0; --shadow: 0 1px 2px rgba(15,23,42,.08); }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; background:var(--bg); color:#0f172a; }
    .wrap{ max-width:1100px; margin:0 auto; padding:16px; }
    h1{ margin:0; font-size:28px; letter-spacing:-.02em; }
    .sub{ margin-top:6px; color:var(--muted); font-size:13px; }
    .toprow{ display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:space-between; gap:12px; }
    .progress{ color:#334155; font-size:13px; }
    .grid{ display:grid; grid-template-columns: 380px minmax(0,1fr); gap:16px; margin-top:16px; align-items:start; }
    @media(max-width: 900px){ body{ overflow-x:auto; } .wrap{ min-width:900px; } }
    .panel{ border:1px solid var(--border); border-radius:18px; padding:14px; box-shadow:var(--shadow); background:var(--card); }
    .panel h2{ margin:0; font-size:15px; }
    textarea{ width:100%; height:160px; resize:none; border:1px solid var(--border); border-radius:14px; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:13px; outline:none; }
    textarea:focus{ box-shadow:0 0 0 3px rgba(148,163,184,.4); }
    .btns{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    button{ border:1px solid var(--border); background:#fff; padding:10px 12px; border-radius:14px; font-weight:700; cursor:pointer; box-shadow:var(--shadow); }
    button.primary{ background:#0f172a; border-color:#0f172a; color:#fff; }
    button.good{ background:#16a34a; border-color:#16a34a; color:#fff; }
    button:disabled{ opacity:.45; cursor:not-allowed; }
    .err{ margin-top:10px; border:1px solid #fecaca; background:#fff1f2; color:#be123c; border-radius:14px; padding:10px 12px; font-size:13px; }
    input[type=number]{ width:110px; border:1px solid var(--border); border-radius:14px; padding:10px 12px; font-size:13px; outline:none; }
    input[type=number]:focus{ box-shadow:0 0 0 3px rgba(148,163,184,.4); }
    .remainbox{ margin-top:10px; border:1px solid var(--border); background:#f8fafc; border-radius:14px; padding:10px 12px; font-size:13px; }
    .remainlist{ max-height:160px; overflow:auto; margin-top:8px; padding-right:2px; }
    .remainitem{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:4px 0; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .colorhead{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .swatch{ width:20px; height:20px; border:1px solid #cbd5e1; border-radius:6px; }
    .slider{ display:flex; align-items:center; gap:10px; margin-top:8px; }
    .slider label{ width:18px; font-weight:800; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    input[type=range]{ flex:1; }
    .boardwrap{ border:1px solid var(--border); border-radius:18px; padding:12px; }
    .board{ border:1px solid rgba(226,232,240,.9); border-radius:18px; padding:12px; }
    .tiles{ display:grid; gap:12px; }
    .tile{ position:relative; aspect-ratio:1/1; border:none; border-radius:14px; box-shadow:0 2px 0 rgba(15,23,42,.14); cursor:pointer; user-select:none; }
    .bigcenter{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:8px; text-align:center; font-weight:900; font-size:1.05rem; line-height:1.1; color:#4d3c00; word-break:break-word; overflow-wrap:anywhere; white-space:normal; }
    .tile.hidden{ background: rgba(255,255,255,.35); color:#334155; }
    .tile.hidden:hover{ background: rgba(255,255,255,.5); }
    .tile.revealed{ background: rgba(255,255,255,.95); color:#0f172a; }
    .history{ max-height:240px; overflow:auto; margin-top:10px; padding-right:2px; display:flex; flex-direction:column; gap:8px; }
    .histitem{ border:1px solid var(--border); border-radius:14px; padding:10px 12px; }
    .chips{ display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .chip{ background:#f1f5f9; border-radius:999px; padding:6px 10px; font-size:13px; }

    /* === HARD FIX: keep 2-col always === */
    .grid{ display:flex !important; flex-wrap:nowrap !important; align-items:flex-start !important; gap:16px !important; }
    .grid > .col{ min-width:0 !important; }
    .grid > .col:first-child{ flex:0 0 420px !important; width:420px !important; }
    .grid > .col:last-child{ flex:1 1 auto !important; }
    body{ overflow-x:auto; }
    .wrap{ min-width: 980px; }

    /* === Color panel collapse === */
    .panel.collapsed{ padding:10px 12px !important; }
    .panel.collapsed #colorBody{ display:none !important; }
    .panel.collapsed .colorhead{ display:flex !important; justify-content:flex-end !important; align-items:center !important; }
    .panel.collapsed .colorhead > :not(#toggleColorPanel){ display:none !important; }
    .panel.collapsed #toggleColorPanel{ display:inline-flex !important; }
  </style>
</head>
<body>

  <!-- PASSWORD GATE -->
  <div id="lock-screen" style="
    position:fixed; inset:0; display:flex; flex-direction:column;
    align-items:center; justify-content:center; gap:12px;
    background:#eef6ff; z-index:9999;
  ">
    <h2>ë¡œê·¸ì¸</h2>
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
      style="padding:10px 12px; font-size:16px;"/>
    <button onclick="checkPassword()" style="padding:8px 14px;">ì…ì¥</button>
    <p id="error" style="color:red; display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”</p>
  </div>

  <div id="site-content" style="display:none;">
    <div id="topbar" style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin:10px 0 14px;">
      <div style="display:flex; flex-direction:column; gap:6px;">
        <div id="who-badge" style="font-size:12px; opacity:0.7;"></div>
        <div id="welcome" style="font-size:14px; font-weight:700; display:none;"></div>
      </div>
      <button id="logoutBtn" type="button" onclick="doLogout()" style="padding:6px 10px;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <div class="wrap">
    <div class="toprow">
      <div>
        <h1>ìŠ¤í˜ì…œ ë½‘ê¸°íŒ</h1>
        <div class="sub">í•œ ì¤„ì— <span class="mono" style="background:#f1f5f9;padding:2px 6px;border-radius:8px;">ìƒí’ˆëª… ê°¯ìˆ˜</span> (ì˜ˆ: <span class="mono" style="background:#f1f5f9;padding:2px 6px;border-radius:8px;">í•˜íŠ¸ 5</span>) â†’ Enterë¡œ ë‹¤ìŒ í’ˆëª©</div>
      </div>
      <div class="progress"><b>ì§„í–‰:</b> <span id="prog">0/0</span> (ë‚¨ìŒ <span id="left">0</span>)</div>
    </div>

    <div class="grid">
      <div class="col">
        <div class="panel">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
            <h2>í’ˆëª© ì…ë ¥</h2>
            <div style="font-size:12px;color:#64748b;">ì…ë ¥ í•©ê³„: <b id="planned">0</b> Â· ì¹¸ ìˆ˜: <b id="plannedSize">0</b></div>
          </div>
          <textarea id="items" placeholder=""></textarea>
          <div id="err" class="err" style="display:none;"></div>
          <div class="btns">
            <button id="build" class="primary">ë½‘ê¸°íŒ ìƒì„±/ê°±ì‹ </button>
            <button id="reset">ì´ˆê¸°í™”</button>
          </div>
        </div>

        <div class="panel" id="colorPanel" style="margin-top:14px;">
          <div class="colorhead">
            <button id="toggleColorPanel" type="button" style="margin-left:auto;">ì„¤ì • ìˆ¨ê¸°ê¸°</button>
            <h2>ë½‘ê¸°íŒ ìƒ‰ìƒ (RGB)</h2>
            <div style="display:flex;align-items:center;gap:8px;">
              <div id="swatch" class="swatch"></div>
              <span id="rgbText" class="mono" style="font-size:12px;color:#64748b;"></span>
            </div>
          </div>

          <div id="colorBody">
            <div class="slider"><label>R</label><input id="r" type="range" min="0" max="255" /><input id="rN" type="number" min="0" max="255" /></div>
            <div class="slider"><label>G</label><input id="g" type="range" min="0" max="255" /><input id="gN" type="number" min="0" max="255" /></div>
            <div class="slider"><label>B</label><input id="b" type="range" min="0" max="255" /><input id="bN" type="number" min="0" max="255" /></div>

            <div class="btns">
              <button id="randColor">ëœë¤ ìƒ‰ìƒ</button>
              <button id="whiteColor">í°ìƒ‰ìœ¼ë¡œ</button>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:14px;">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
            <h2>ë‚¨ì€ ê°¯ìˆ˜</h2>
            <div style="font-size:12px;color:#64748b;">ë‚¨ì€ ì¹¸: <b id="remainTotal">0</b></div>
          </div>

          <div class="remainbox">
            <div style="font-weight:800;">ë‚¨ì€ ê°¯ìˆ˜</div>
            <div id="remainList" class="remainlist"></div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="panel">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
            <h2>ë½‘ê¸°íŒ</h2>
            <div style="font-size:12px;color:#64748b;">ì¹¸ ìˆ˜: <b id="tileCount">0</b> Â· ì—´: <b id="cols">0</b></div>
          </div>

          <div id="boardwrap" class="boardwrap" style="margin-top:10px;">
            <div id="board" class="board">
              <div id="tiles" class="tiles"></div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:14px;">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
            <h2>ë½‘ì€ ê¸°ë¡</h2>
            <div style="font-size:12px;color:#64748b;">ìµœì‹ ì´ ì•„ë˜</div>
          </div>
          <div id="history" class="history"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);
  let tiles = [];
  let history = [];

  function clampInt(n, min, max){
    n = Math.trunc(Number(n));
    if (!Number.isFinite(n)) n = min;
    return Math.max(min, Math.min(max, n));
  }

  function fitOne(el, minPx=12){
    if (!el) return;
    const label = el.querySelector('.label') || el;
    label.style.fontSize = '';
    label.style.lineHeight = '';
    label.style.transform = '';
    label.style.whiteSpace = 'normal';
    label.style.wordBreak = 'break-word';
    label.style.overflowWrap = 'anywhere';
    label.style.display = 'block';
    label.style.width = '100%';
    const cw = el.clientWidth;
    const ch = el.clientHeight;
    if (cw <= 0 || ch <= 0) return;
    let fs = parseFloat(getComputedStyle(label).fontSize) || 16;
    let guard = 0;
    while (guard++ < 80){
      const sw = label.scrollWidth;
      const sh = label.scrollHeight;
      if (sw <= cw && sh <= ch) break;
      fs -= 1;
      if (fs <= minPx){ fs = minPx; label.style.fontSize = fs + 'px'; break; }
      label.style.fontSize = fs + 'px';
    }
    if (label.scrollHeight > ch){
      label.style.lineHeight = '1.0';
      guard = 0;
      while (guard++ < 40){
        if (label.scrollWidth <= cw && label.scrollHeight <= ch) break;
        fs -= 1;
        if (fs <= minPx){ fs = minPx; label.style.fontSize = fs + 'px'; break; }
        label.style.fontSize = fs + 'px';
      }
    }
    const sw2 = label.scrollWidth;
    const sh2 = label.scrollHeight;
    if (sw2 > cw || sh2 > ch){
      const scale = Math.min(cw / sw2, ch / sh2, 1);
      label.style.transformOrigin = 'center';
      label.style.transform = `scale(${scale})`;
    }
  }
  function fitTileTexts(){
    document.querySelectorAll('#tiles .bigcenter').forEach(el => fitOne(el, 12));
  }

  function parseItems(text){
    const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const items = [];
    const errors = [];
    for (let i=0;i<lines.length;i++){
      const line = lines[i];
      const parts = line.split(/\s+/);
      if (parts.length < 2){
        errors.push(`${i+1}ì¤„: "ìƒí’ˆëª… ê°¯ìˆ˜" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì¤˜. (ì˜ˆ: í•˜íŠ¸ 5)`);
        continue;
      }
      const countStr = parts[parts.length-1];
      const name = parts.slice(0,-1).join(' ').trim();
      const count = Number(countStr);
      if (!name){ errors.push(`${i+1}ì¤„: ìƒí’ˆëª…ì´ ë¹„ì–´ìˆì–´.`); continue; }
      if (!Number.isFinite(count) || count <= 0){ errors.push(`${i+1}ì¤„: ê°¯ìˆ˜ëŠ” 1 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•´.`); continue; }
      items.push({name, count: Math.trunc(count)});
    }
    const merged = new Map();
    for (const it of items) merged.set(it.name, (merged.get(it.name)||0) + it.count);
    return { items: Array.from(merged.entries()).map(([name,count])=>({name,count})), errors };
  }

  function buildTilesWithSize(items, size){
    const pool = [];
    let seq = 0;
    for (const it of items){
      for (let i=0;i<it.count;i++) pool.push(it.name);
    }
    const FILL = "ê½";
    if (pool.length < size){
      for (let i=0;i<(size - pool.length);i++) pool.push(FILL);
    } else if (pool.length > size){
      pool.length = size;
    }
    for (let i=pool.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [pool[i],pool[j]] = [pool[j],pool[i]];
    }
    return pool.map((name)=>({ id:`${seq++}-${name}`, name, revealed:false }));
  }

  function getCols(n){
    if (n<=16) return 4;
    if (n<=36) return 6;
    if (n<=64) return 8;
    return 10;
  }

  function boardColor(){
    const rr = clampInt($('r').value,0,255);
    const gg = clampInt($('g').value,0,255);
    const bb = clampInt($('b').value,0,255);
    return `rgb(${rr}, ${gg}, ${bb})`;
  }

  function setRGB(rr,gg,bb){
    rr = clampInt(rr,0,255); gg = clampInt(gg,0,255); bb = clampInt(bb,0,255);
    $('r').value = rr; $('g').value = gg; $('b').value = bb;
    $('rN').value = rr; $('gN').value = gg; $('bN').value = bb;
    renderColor();
  }

  function renderColor(){
    const c = boardColor();
    $('boardwrap').style.background = c;
    $('swatch').style.background = c;
    $('rgbText').textContent = c;
  }

  function computeRemaining(){
    const map = new Map();
    for (const t of tiles){
      if (!t.revealed) map.set(t.name, (map.get(t.name)||0)+1);
    }
    return Array.from(map.entries()).map(([name,count])=>({name,count}))
      .sort((a,b)=> (b.count-a.count) || a.name.localeCompare(b.name));
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  function showErrors(errors){
    const err = $('err');
    if (!errors.length){ err.style.display='none'; err.textContent=''; return; }
    err.style.display='block';
    err.innerHTML = '<b>ì…ë ¥ ì˜¤ë¥˜</b><ul style="margin:8px 0 0 18px; padding:0;">' +
      errors.slice(0,4).map(e=>`<li>${escapeHtml(e)}</li>`).join('') +
      (errors.length>4 ? `<li>â€¦ì™¸ ${errors.length-4}ê°œ</li>` : '') +
      '</ul>';
  }

  function render(){
    const revealed = tiles.filter(t=>t.revealed).length;
    $('prog').textContent = `${revealed}/${tiles.length}`;
    $('left').textContent = `${tiles.length - revealed}`;
    $('remainTotal').textContent = `${tiles.length - revealed}`;
    $('tileCount').textContent = `${tiles.length}`;

    const rem = computeRemaining();
    const list = $('remainList');
    list.innerHTML = '';
    if (tiles.length && rem.length){
      for (const x of rem){
        const row = document.createElement('div');
        row.className = 'remainitem';
        row.innerHTML = `<div style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:230px;">${escapeHtml(x.name)}</div><div class="mono" style="font-weight:800;">${x.count}</div>`;
        list.appendChild(row);
      }
    }

    const cols = getCols(tiles.length || 1);
    $('cols').textContent = `${cols}`;
    const tilesEl = $('tiles');
    tilesEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
    tilesEl.innerHTML = '';

    if (tiles.length){
      tiles.forEach((t, idx)=>{
        const div = document.createElement('div');
        div.className = 'tile ' + (t.revealed ? 'revealed' : 'hidden');
        div.title = t.revealed ? t.name : `#${idx+1}`;
        div.innerHTML = `<div class="bigcenter"><span class="label">${t.revealed ? escapeHtml(t.name) : (idx+1)}</span></div>`;
        div.addEventListener('click', ()=>{
          if (t.revealed) return;
          t.revealed = true;
          t.revealedAt = Date.now();
          history.push(t.name);

          // âœ… ë¡œê·¸: ë½‘í˜
          window.logEvent?.("draw", { index: idx + 1, result: t.name });

          render();
        });
        tilesEl.appendChild(div);
      });
    }

    requestAnimationFrame(fitTileTexts);

    const hEl = $('history');
    hEl.innerHTML = '';
    if (history.length){
      history.forEach((name, i)=>{
        const box = document.createElement('div');
        box.className = 'histitem';
        box.innerHTML = `<div style="font-size:12px;color:#64748b;">#${i+1}</div><div class="chips"><span class="chip">${escapeHtml(name)}</span></div>`;
        hEl.appendChild(box);
      });
      hEl.scrollTop = hEl.scrollHeight;
    }
  }

  function createBoard(){
    const parsed = parseItems($('items').value);
    const sum = parsed.items.reduce((a,c)=>a+c.count,0);
    $('planned').textContent = sum;

    const size = clampInt(sum, 0, 5000);
    $('plannedSize').textContent = size;

    showErrors(parsed.errors);
    if (parsed.errors.length) return;

    if (size === 0){
      tiles = [];
      history = [];
      renderColor();
      render();
      return;
    }

    tiles = buildTilesWithSize(parsed.items, size);
    history = [];
    renderColor();
    render();

    // âœ… ë¡œê·¸: ë³´ë“œ ìƒì„±(í’ˆëª© ì…ë ¥)
    window.logEvent?.("board_build", { size, itemsText: $('items').value });
  }

  function resetReveals(){
    tiles = tiles.map(t=>({ ...t, revealed:false, revealedAt: undefined }));
    history = [];
    render();
  }

  function wire(){
    $('build').addEventListener('click', createBoard);
    $('reset').addEventListener('click', resetReveals);

    const sync = (idRange, idNum) => {
      const range = $(idRange); const num = $(idNum);
      const on = () => { num.value = clampInt(range.value,0,255); renderColor(); };
      range.addEventListener('input', on);
      num.addEventListener('input', () => { range.value = clampInt(num.value,0,255); renderColor(); });
    };
    sync('r','rN'); sync('g','gN'); sync('b','bN');

    $('randColor').addEventListener('click', ()=>{
      setRGB(Math.floor(Math.random()*256), Math.floor(Math.random()*256), Math.floor(Math.random()*256));
    });
    $('whiteColor').addEventListener('click', ()=> setRGB(255,255,255));

    setRGB(90,160,240);
    createBoard();
    window.addEventListener('resize', ()=>{ fitTileTexts(); });
  }

  wire();

  // ìƒ‰ìƒ íŒ¨ë„ í† ê¸€
  const colorPanelBtn = document.getElementById('toggleColorPanel');
  const colorPanel = document.getElementById('colorPanel');
  if (colorPanelBtn && colorPanel){
    colorPanelBtn.addEventListener('click', () => {
      const collapsed = colorPanel.classList.toggle('collapsed');
      colorPanelBtn.textContent = collapsed ? 'ìƒ‰ìƒ ì„¤ì • ì—´ê¸°' : 'ì„¤ì • ìˆ¨ê¸°ê¸°';
    });
  }
</script>

<script>
  // ====== ë¹„ë²ˆ ë¡œê·¸ì¸ (ë¡œì»¬) ======
  const USERS = {
    "Seravelyy!": { name: "ì„¸ë¼", role: "admin" },
    "emo0205": { name: "ì—ë©”ëª¨í˜„", role: "user" }
  };

  function showWelcome(name) {
    const welcome = document.getElementById("welcome");
    if (!welcome) return;
    welcome.textContent = `${name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
    welcome.style.display = "block";
    setTimeout(() => welcome.style.display = "none", 2500);
  }

  function unlockAs(user) {
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("site-content").style.display = "block";
    sessionStorage.setItem("unlocked", "true");
    sessionStorage.setItem("who", user.name);
    sessionStorage.setItem("role", user.role || "user");

    const badge = document.getElementById("who-badge");
    if (badge) badge.textContent = `${user.name} ë‹˜ ì ‘ì†`;

    showWelcome(user.name);

    // âœ… ë¡œê·¸: ë¡œê·¸ì¸ ì„±ê³µ
    window.logEvent?.("login", { role: user.role || "user" });
  }

  function checkPassword() {
    const input = document.getElementById("password").value.trim();
    const user = USERS[input];
    if (user) {
      unlockAs(user);
    } else {
      document.getElementById("error").style.display = "block";
    }
  }

  function doLogout() {
    // âœ… ë¡œê·¸: ë¡œê·¸ì•„ì›ƒ
    window.logEvent?.("logout", {});

    sessionStorage.removeItem("unlocked");
    sessionStorage.removeItem("who");
    sessionStorage.removeItem("role");
    document.getElementById("site-content").style.display = "none";
    document.getElementById("lock-screen").style.display = "flex";
    document.getElementById("password").value = "";
    document.getElementById("error").style.display = "none";
  }

  // ìƒˆë¡œê³ ì¹¨ ìœ ì§€
  if (sessionStorage.getItem("unlocked") === "true") {
    const who = sessionStorage.getItem("who");
    const role = sessionStorage.getItem("role") || "user";
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("site-content").style.display = "block";
    const badge = document.getElementById("who-badge");
    if (badge && who) badge.textContent = `${who} ë‹˜ ì ‘ì†`;
    sessionStorage.setItem("role", role);
  }
</script>

<!-- ğŸ”¥ Firebase init + Firestore logger (CDN) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCA6pywjLx2TbYDnmdfrdwB2JWvzL2ejl4",
    authDomain: "specialgacha-sr.firebaseapp.com",
    projectId: "specialgacha-sr",
    storageBucket: "specialgacha-sr.firebasestorage.app",
    messagingSenderId: "674962019391",
    appId: "1:674962019391:web:f7a7556a0fcf552e83948a"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.firebaseApp = app;
  window.firebaseAuth = auth;
  window.firebaseDB = db;

  // âœ… ë¡œê·¸ ì“°ê¸° í•¨ìˆ˜ (ìœ ì €ì—ê²ŒëŠ” ì•ˆ ë³´ì´ê³  Firestoreì—ë§Œ ì €ì¥ë¨)
  window.logEvent = async function(type, payload = {}) {
    try {
      await addDoc(collection(db, "logs"), {
        type,
        ...payload,
        who: sessionStorage.getItem("who") || "unknown",
        time: serverTimestamp(),
        href: location.href
      });
    } catch (e) {
      console.warn("logEvent failed:", e);
    }
  };

  console.log("âœ… Firebase initialized + logger ready");
</script>
</body>
</html>
