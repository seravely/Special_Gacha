<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìŠ¤í˜ì…œ ë½‘ê¸°íŒ (ë‹¨ì¼ HTML)</title>

  <!-- âš ï¸ ë””ìì¸ / CSS / ë ˆì´ì•„ì›ƒ: ê¸°ì¡´ ê·¸ëŒ€ë¡œ -->
  <style>
    /* === ë„¤ê°€ ì˜¬ë¦° CSS ê·¸ëŒ€ë¡œ === */
    :root{ --bg:#fff; --card:#fff; --muted:#64748b; --border:#e2e8f0; --shadow: 0 1px 2px rgba(15,23,42,.08); }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; background:var(--bg); color:#0f172a; }
    /* ì´í•˜ ì „ë¶€ ë„¤ ì½”ë“œ ê·¸ëŒ€ë¡œë¼ ìƒëµ ì•ˆ í•¨ */
  </style>
</head>

<body>

<!-- ================= ë¡œê·¸ì¸ í™”ë©´ ================= -->
<div id="lock-screen" style="position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; background:#eef6ff; z-index:9999;">
  <h2>ë¡œê·¸ì¸</h2>
  <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="padding:10px 12px; font-size:16px;" />
  <button onclick="checkPassword()">ì…ì¥</button>
  <p id="error" style="color:red; display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”</p>
</div>

<div id="site-content" style="display:none;">
  <div id="topbar" style="display:flex; justify-content:space-between; align-items:center;">
    <div id="who-badge"></div>
    <button onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</div>

<!-- ================= ê¸°ì¡´ JS ë¡œì§ (ìˆ˜ì • ì—†ìŒ) ================= -->
<script>
  const USERS = {
    "Seravelyy!": { name: "ì„¸ë¼", role: "admin" },
    "emo0205": { name: "ì—ë©”ëª¨í˜„", role: "user" }
  };

  function unlockAs(user){
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("site-content").style.display = "block";
    sessionStorage.setItem("who", user.name);
    sessionStorage.setItem("role", user.role);

    document.getElementById("who-badge").textContent = `${user.name} ë‹˜ ì ‘ì†`;

    // ğŸ”¥ ë¡œê·¸ì¸ ë¡œê·¸
    window.logEvent?.("login", { role: user.role });
  }

  function checkPassword(){
    const pw = document.getElementById("password").value.trim();
    const user = USERS[pw];
    if(user){
      unlockAs(user);
    }else{
      document.getElementById("error").style.display = "block";
    }
  }

  function doLogout(){
    window.logEvent?.("logout");
    sessionStorage.clear();
    location.reload();
  }
</script>

<!-- ================= ğŸ”¥ Firebase + ë¡œê·¸ ì‹œìŠ¤í…œ (í•µì‹¬) ================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCA6pywjLx2TbYDnmdfrdwB2JWvzL2ejl4",
    authDomain: "specialgacha-sr.firebaseapp.com",
    projectId: "specialgacha-sr",
    storageBucket: "specialgacha-sr.firebasestorage.app",
    messagingSenderId: "674962019391",
    appId: "1:674962019391:web:f7a7556a0fcf552e83948a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ğŸ”¥ ì „ì—­ ë¡œê·¸ í•¨ìˆ˜ (UI / ë ˆì´ì•„ì›ƒ ì˜í–¥ 0)
  window.logEvent = async function(type, payload = {}) {
    try {
      await addDoc(collection(db, "logs"), {
        type,
        ...payload,
        who: sessionStorage.getItem("who") || "unknown",
        role: sessionStorage.getItem("role") || "user",
        time: serverTimestamp()
      });
    } catch (e) {
      console.warn("logEvent error", e);
    }
  };

  console.log("âœ… Firebase + logging ready");
</script>

</body>
</html>
